@model List<WebApplication2.Models.Order>
@using System.Linq
@using Azure.Core
@{
	Layout = "/Views/Shared/_DefaultLayout.cshtml";
}

<!DOCTYPE html>
<html lang="fa">
<head>
	<meta charset="UTF-8">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">

	<style>
		body {
			background-color: #f8f9fa;
			font-family: 'Vazirmatn', sans-serif;
			direction: rtl;
		}

		a {
			text-decoration: none;
			color: inherit;
		}
		.stats {
			display: flex;
			justify-content: space-around;
			flex-wrap: wrap;
			margin: 30px auto;
			max-width: 1100px;
		}

		.card-stat {
			background: white;
			border-radius: 12px;
			box-shadow: 0 2px 6px rgba(0,0,0,0.05);
			padding: 25px;
			text-align: center;
			flex: 1 1 250px;
			margin: 10px;
			transition: 0.3s;
		}

			.card-stat:hover {
				transform: translateY(-4px);
				box-shadow: 0 4px 10px rgba(0,0,0,0.1);
			}

			.card-stat h3 {
				color: #0d6efd;
				font-size: 24px;
				font-weight: 700;
			}

			.card-stat span {
				color: #6c757d;
				font-size: 15px;
			}

		.btn-create {
			display: inline-block;
			background-color: #0d6efd;
			color: white;
			padding: 10px 20px;
			border-radius: 8px;
			text-decoration: none;
			font-weight: 600;
			transition: 0.3s;
		}

			.btn-create:hover {
				background-color: #084cd6;
			}

		.table-container {
			margin: 30px auto;
			max-width: 1100px;
		}

		table {
			background: white;
			overflow: hidden;
			box-shadow: 0 2px 6px rgba(0,0,0,0.05);
			width: 100%;
			border-collapse: collapse;
			border: 1px solid #ddd; /* خط دور جدول */
		}

			table th, table td {
				padding: 10px;
				border: none; /* حذف همه خطوط داخلی */
			}

			table tr {
				border-bottom: 1px solid #ddd; /* فقط خط بین ردیف‌ها */
			}

				table tr:last-child {
					border-bottom: none; /* آخرین ردیف خط نداشته باشد */
				}

		thead {
			background: #0d6efd;
			color: white;
		}

		tbody tr:nth-child(even) {
			background-color: #f9f9f9;
		}

		tbody tr:hover {
			background-color: #eef4ff;
		}

		.status-success {
			color: #16a34a;
			font-weight: 600;
		}

		.status-failed {
			color: #dc2626;
			font-weight: 600;
		}

		.status-pending {
			color: #ffc107;
			font-weight: 600;
		}

		.copy-text {
			cursor: pointer;
			color: #0d6efd;
			display: inline-flex;
			align-items: center;
			gap: 4px;
		}

			.copy-text:hover {
				opacity: 0.8;
			}



		.copied {
			color: #198754;
			font-size: 13px;
			margin-right: 5px;
		}
	</style>
</head>
<body>
	<div class="container">
		<div class="stats">
			<div class="card-stat">
				<h3>@ViewBag.TotalPayments</h3>
				<span>کل پرداخت‌ها</span>
			</div>
			<div class="card-stat">
				<h3>@ViewBag.PaidPayments</h3>
				<span>پرداخت شده</span>
			</div>
			<div class="card-stat">
				<h3>@ViewBag.PendingPayments</h3>
				<span>در انتظار پرداخت</span>
			</div>
			<div class="card-stat">
				<h3>@ViewBag.TotalAmount.ToString("N0") تومان</h3>
				<span>جمع کل مبالغ</span>
			</div>
		</div>

		<div class="text-end mb-3">
			<a href="/Payment/Payment" class="btn-create">+ ایجاد لینک جدید</a>
		</div>

		<div class="table-container">
			@if (Model != null && Model.Any())
			{
				<h5 class="text-center mb-3 text-primary fw-bold">لیست تراکنش‌ها</h5>
				<table class="table table-bordered align-middle">
					<thead>
						<tr>

							<th>
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
									<path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z" />
								</svg>
								نام مشتری
							</th>
							<th>
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat" viewBox="0 0 16 16">
									<path d="M2.678 11.894a1 1 0 0 1 .287.801 11 11 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8 8 0 0 0 8 14c3.996 0 7-2.807 7-6s-3.004-6-7-6-7 2.808-7 6c0 1.468.617 2.83 1.678 3.894m-.493 3.905a22 22 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a10 10 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9 9 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105" />
								</svg>
								توضیحات
							</th>
							<th>
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-circle" viewBox="0 0 16 16">
									<path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16" />
									<path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
								</svg>
								مبلغ
							</th>
							<th>
								<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" stroke="currentColor" stroke-width="1.5" class="ms-1">
									<circle cx="7" cy="7" r="6" />
								</svg>
								وضعیت
							</th>
							<th>
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-telephone" viewBox="0 0 16 16">
									<path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.6 17.6 0 0 0 4.168 6.608 17.6 17.6 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.68.68 0 0 0-.58-.122l-2.19.547a1.75 1.75 0 0 1-1.657-.459L5.482 8.062a1.75 1.75 0 0 1-.46-1.657l.548-2.19a.68.68 0 0 0-.122-.58zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.68.68 0 0 0 .178.643l2.457 2.457a.68.68 0 0 0 .644.178l2.189-.547a1.75 1.75 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.6 18.6 0 0 1-7.01-4.42 18.6 18.6 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877z" />
								</svg>
								شماره تماس
							</th>
							<th>
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-lightning" viewBox="0 0 16 16">
									<path d="M5.52.359A.5.5 0 0 1 6 0h4a.5.5 0 0 1 .474.658L8.694 6H12.5a.5.5 0 0 1 .395.807l-7 9a.5.5 0 0 1-.873-.454L6.823 9.5H3.5a.5.5 0 0 1-.48-.641zM6.374 1 4.168 8.5H7.5a.5.5 0 0 1 .478.647L6.78 13.04 11.478 7H8a.5.5 0 0 1-.474-.658L9.306 1z" />
								</svg>
								عملیات
							</th>
						</tr>
					</thead>
					<tbody>
						@foreach (var item in Model)
						{
							var paymentUrl = Url.Action("PaymentGateway", "Payment", new { id = item.OrderId }, Context.Request.Scheme);
							<tr>
								<td>@item.CustomerName</td>
								<td>@item.Description</td>
								<td>@item.Amount.ToString("N0") تومان</td>
								<td>
									@if (item.IsPaid == true)
									{
										<span class="status-success">پرداخت شد ✅</span>
									}
									else if (item.IsPaid == false)
									{
										<span class="status-failed">انصراف ❌</span>
									}
									else
									{
										<span class="status-pending">در انتظار پرداخت</span>
									}
								</td>
								<td>@item.Phone</td>
								@*<td>

									<button class="btn-copy" onclick="copyToClipboard('@paymentUrl', this)">کپی لینک</button>
								</td> *@

								<td>
									<span class="copy-text" data-link="@paymentUrl">
										<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
											 class="bi bi-copy" viewBox="0 0 16 16">
											<path fill-rule="evenodd"
												  d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z" />
										</svg>
										کپی لینک
									</span>
								</td>


							</tr>
						}
					</tbody>
				</table>
			}

			<!-- صفحه‌بندی -->
			<div class="d-flex justify-content-center mt-3">
				<nav>
					<ul class="pagination">
						@if (ViewBag.CurrentPage > 1)
						{
							<li class="page-item">
								<a class="page-link" href="@Url.Action("PaymentList", new { page = ViewBag.CurrentPage - 1 })">قبلی</a>
							</li>
						}

						@for (int i = 1; i <= ViewBag.TotalPages; i++)
						{
							<li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
								<a class="page-link" href="@Url.Action("PaymentList", new { page = i })">@i</a>
							</li>
						}

						@if (ViewBag.CurrentPage < ViewBag.TotalPages)
						{
							<li class="page-item">
								<a class="page-link" href="@Url.Action("PaymentList", new { page = ViewBag.CurrentPage + 1 })">بعدی</a>
							</li>
						}
					</ul>
				</nav>
			</div>
		</div>
	</div>

	<script>
		document.addEventListener("click", function (e) {
			if (e.target.closest(".copy-text")) {
				const el = e.target.closest(".copy-text");
				const link = el.dataset.link;

				navigator.clipboard.writeText(link).then(() => {
					el.innerHTML = "✅ کپی شد";
					setTimeout(() => {
						el.innerHTML = `
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
								 class="bi bi-copy" viewBox="0 0 16 16">
								<path fill-rule="evenodd"
									  d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z" />
							</svg>
							کپی لینک
						`;
					}, 2000);
				});
			}
		});
	</script>

</body>
</html>



